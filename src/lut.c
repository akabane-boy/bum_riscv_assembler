#include <stdio.h>
#include <string.h>
#include "../include/lut.h"

const InstLUTEntry instruction_table[] = {
	/*
	 * { mnemonic, opcode, funct3, funct7, type }
	 */
	/* R-type */
	{ "add", 0x33, 0x0, 0x00, TYPE_R },
	{ "sub", 0x33, 0x0, 0x20, TYPE_R },
	{ "sll", 0x33, 0x1, 0x00, TYPE_R },
	{ "slt", 0x33, 0x2, 0x00, TYPE_R },
	{ "sltu", 0x33, 0x3, 0x00, TYPE_R },
	{ "xor", 0x33, 0x4, 0x00, TYPE_R },
	{ "srl", 0x33, 0x5, 0x00, TYPE_R },
	{ "sra", 0x33, 0x5, 0x20, TYPE_R },
	{ "or", 0x33, 0x6, 0x00, TYPE_R },
	{ "and", 0x33, 0x7, 0x00, TYPE_R },

	/* I-type */
	{ "addi", 0x13, 0x0, 0x00, TYPE_I },
	{ "slti", 0x13, 0x2, 0x00, TYPE_I },
	{ "sltiu", 0x13, 0x3, 0x00, TYPE_I },
	{ "xori", 0x13, 0x4, 0x00, TYPE_I },
	{ "ori", 0x13, 0x6, 0x00, TYPE_I },
	{ "andi", 0x13, 0x7, 0x00, TYPE_I },
	{ "slli", 0x13, 0x1, 0x00, TYPE_I },
	{ "srli", 0x13, 0x5, 0x00, TYPE_I },
	{ "srai", 0x13, 0x5, 0x20, TYPE_I },
	{ "lb", 0x03, 0x0, 0x00, TYPE_I },
	{ "lh", 0x03, 0x1, 0x00, TYPE_I },
	{ "lw", 0x03, 0x2, 0x00, TYPE_I },
	{ "lbu", 0x03, 0x4, 0x00, TYPE_I },
	{ "lhu", 0x03, 0x5, 0x00, TYPE_I },

	/* S-type */
	{ "sb", 0x23, 0x0, 0x00, TYPE_S },
	{ "sh", 0x23, 0x1, 0x00, TYPE_S },
	{ "sw", 0x23, 0x2, 0x00, TYPE_S },

	/* B-type */
	{ "beq", 0x63, 0x0, 0x00, TYPE_B },
	{ "bne", 0x63, 0x1, 0x00, TYPE_B },
	{ "blt", 0x63, 0x4, 0x00, TYPE_B },
	{ "bge", 0x63, 0x5, 0x00, TYPE_B },
	{ "bltu", 0x63, 0x6, 0x00, TYPE_B },
	{ "bgeu", 0x63, 0x7, 0x00, TYPE_B },

	/* U-type */
	{ "lui", 0x37, 0x00, 0x00, TYPE_U },
	{ "auipc", 0x17, 0x00, 0x00, TYPE_U },

	/* J-type */
	{ "jal", 0x6F, 0x00, 0x00, TYPE_J },
	{ "jalr", 0x67, 0x00, 0x00, TYPE_J },

	/* NOP-type */
	{ "nop", 0x13, 0x0, 0x00, TYPE_NOP },

	/* INVALID-type */
	{ NULL, 0x00, 0x0, 0x00, TYPE_INVALID }
};

/* 
 * Returns pointer of InstLUTEntry.
 * Since if InstLUTEntry was returned, additional memory would be needed.
 * Instead, returning pointer of constants was used.
 */
const InstLUTEntry *lookup_inst(const char *mnemonic)
{
	for (size_t i = 0; i < NUM_OF_MNEMONIC; i++) {
		if (strcmp(mnemonic, instruction_table[i].mnemonic) == 0) {
			return &instruction_table[i];
		}
	}
	return &instruction_table[NUM_OF_MNEMONIC - 1]; /* Returns invalid type */
}
